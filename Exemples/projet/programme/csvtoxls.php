<?php/** * Created by PhpStorm. * User: Frederic * Date: 22/05/2017 * Time: 13:20 */require('Classes/PHPExcel.php');require ('Classes/PHPExcel/IOFactory.php');date_default_timezone_set('Europe/Brussels') ;$DEPARTEMENT="INFO";$Cellule=array();function convertCSVtoXLS($file,$file2,$date,$option=""){    //$objPHPExcel = new PHPExcel();    $matieresCSV = array();    $etudiant = array();    if (!($fp = fopen($file, 'r'))) {        die("** Probleme d'ouverture **");    }    if (!($fp2 = fopen($file2, 'r'))) {        die("** Probleme d'ouverture **");    }    $intilerMatier []=fgetcsv($fp,"1024",";");/// liste intituler  matiere    $intilerEtu []= fgetcsv($fp2,"1024",";");// liste intituler  etudiant    while ($row = fgetcsv($fp,"1024",";")) {        $matieresCSV[] =  $row;    }    while ($row = fgetcsv($fp2,"1024",";")) {        $etudiant[] = $row;    }    fclose($fp);    fclose($fp2);    creation($matieresCSV,$etudiant,$intilerEtu,$intilerMatier,$date,$option);}function creation($matieresCSV,$etudiant ,$intilueretu,$intiluerMatier,$date,$option){    global $DEPARTEMENT;    $matieres=array();    $UE=array();    $autre=array();    $nbSheet=0;    $TabSheet=array();    foreach ($matieresCSV as $donnes){        if ($donnes[0]!=null) {            if ($donnes[0][0] === "M" || $donnes[0][0] === "O") {                $matieres[] = $donnes;            }            else if  ($donnes[0][0]==="U"){                $UE[]=$donnes;            }            else{                $autre[]=$donnes;            }        }    }    $annee=($date-1).$date;    if (file_exists($DEPARTEMENT)===false){        error_log("Le dossier $DEPARTEMENT n'est pas crée");        exit(1);    }    if(file_exists("$DEPARTEMENT/".($date-1)."-".$date)==false){        mkdir("$DEPARTEMENT/".($date-1)."-".$date, 0700);    }    if ($option==""){        $repertoire="$DEPARTEMENT/".($date-1)."-".$date."/".$DEPARTEMENT."_".$autre[4][1]."_".$annee;    }else        $repertoire="$DEPARTEMENT/".($date-1)."-".$date."/".$DEPARTEMENT."_".$autre[4][1]."_".$option."_".$annee;    if (file_exists($repertoire)==false) {        mkdir($repertoire, 0700);        mkdir($repertoire. "/excel", 0700);    }    $objPHPExcel = new PHPExcel();    //  $sheet = $objPHPExcel->getActiveSheet();    $TabSheet["Liste_Matiere"] = $objPHPExcel->getActiveSheet();    /// creation de la liste des matière    $TabSheet["Liste_Matiere"]->setTitle("Liste_Matiere");/// mettre le titre des onglets ou feuille    for ($cpt=0;$cpt<count($intiluerMatier[0]);$cpt++){        $TabSheet["Liste_Matiere"]->setCellValue(chr(65+$cpt)."1" , $intiluerMatier[0][$cpt]);        $TabSheet["Liste_Matiere"]->getStyle(chr(65+$cpt)."1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);/// mettre le contenu centré        $TabSheet["Liste_Matiere"]->getColumnDimension(chr(65+$cpt))->setAutoSize(true);    }    $nbSheet++;    for ($cpt=0;$cpt<count($matieresCSV);$cpt++){        for ($cpt2=0;$cpt2<count($matieresCSV[$cpt]);$cpt2++) {            $TabSheet["Liste_Matiere"]->setCellValue(chr(65 + $cpt2) . ($cpt + 2),$matieresCSV[$cpt][$cpt2]);        }    }    // creation de la liste des etudiants    $TabSheet["Liste_Etudiants"]= $objPHPExcel->createSheet($nbSheet);    $TabSheet["Liste_Etudiants"]->setTitle("Liste_Etudiants");    for ($cpt=0;$cpt<count($intilueretu[0]);$cpt++){        $TabSheet["Liste_Etudiants"]->setCellValue(chr(65+$cpt)."1" , $intilueretu[0][$cpt]);        $TabSheet["Liste_Etudiants"]->getStyle(chr(65+$cpt)."1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $TabSheet["Liste_Etudiants"]->getColumnDimension(chr(65+$cpt))->setAutoSize(true);    }    for ($cpt=0;$cpt<count($etudiant);$cpt++){        for ($cpt2=0;$cpt2<count($etudiant[$cpt]);$cpt2++) {            $TabSheet["Liste_Etudiants"]->setCellValue(chr(65 + $cpt2) . ($cpt + 2),$etudiant[$cpt][$cpt2]);        }    }    $nbSheet++;    // creation décision    $TabSheet["Décision"] = $objPHPExcel->createSheet($nbSheet);    $TabSheet["Décision"]->setTitle("Décision");    for ($cpt=0;$cpt<4;$cpt++){        $TabSheet["Décision"]->setCellValue(chr(65+$cpt)."1" , $intilueretu[0][$cpt]);        $TabSheet["Décision"]->getStyle(chr(65+$cpt)."1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $TabSheet["Décision"]->getColumnDimension(chr(65+$cpt))->setAutoSize(true);    }    $TabSheet["Décision"]->setCellValue("E1" ,"Décions");    $TabSheet["Décision"]->setCellValue(chr(70+count($UE))."1" ,"Commentaire");    $TabSheet["Décision"]->getColumnDimension("I")->setAutoSize(true);    $TabSheet["Décision"]->getStyle("E1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);    $TabSheet["Décision"]->mergeCells('E1:'.chr(70+count($UE)-1).'1');    for ($cptue=0;$cptue<count($UE);$cptue++){        $TabSheet["Décision"]->setCellValue("E2" ,$matieresCSV[0][5]);        $TabSheet["Décision"]->setCellValue(chr(70+$cptue)."2" ,$UE[$cptue][0]);    }    for ($cpt=0;$cpt<count($etudiant);$cpt++){        for ($cpt2=0;$cpt2<4;$cpt2++) {            $TabSheet["Décision"]->setCellValue(chr(65 + $cpt2) . ($cpt + 2),$etudiant[$cpt][$cpt2]);        }    }    for ($cptautre=0;$cptautre<count($autre);$cptautre++){        for ($cpt2=0;$cpt2<count($autre[$cptautre]);$cpt2++) {            $TabSheet["Décision"]->setCellValue(chr(65 + $cpt2) . ($cptautre + count($etudiant) + 5),$autre[$cptautre][$cpt2]);        }    }    $nbSheet++;/// creation absentece    $TabSheet["Absences"] = $objPHPExcel->createSheet($nbSheet);    $Position=array();    $TabSheet["Absences"]->setTitle("Absences");    for    ($cpt=0;$cpt<4;$cpt++){        $TabSheet["Absences"]->setCellValue(chr(65+$cpt)."1" , $intilueretu[0][$cpt]);        $TabSheet["Absences"]->getStyle(chr(65+$cpt)."1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $TabSheet["Absences"]->getColumnDimension(chr(65+$cpt))->setAutoSize(true);    }    $TabSheet["Absences"]->setCellValue("E1" ,"ABI");    $TabSheet["Absences"]->getStyle("E1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);    for ($cptue=0;$cptue<count($UE);$cptue++){        $TabSheet["Absences"]->setCellValue(chr(70+($cptue*2))."1" ,$UE[$cptue][0]);        $TabSheet["Absences"]->getStyle(chr(70+($cptue*2))."1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $TabSheet["Absences"]->getStyle(chr(70+($cptue*2))."2")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $TabSheet["Absences"]->getStyle(chr(70+($cptue*2)+1)."2")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $TabSheet["Absences"]->mergeCells(chr(70+($cptue*2))."1:".chr(70+($cptue*2)+1)."1");        $TabSheet["Absences"]->setCellValue(chr(70+($cptue*2))."2" ,'J');        $TabSheet["Absences"]->setCellValue("E2" ,0.11);        $TabSheet["Absences"]->setCellValue(chr(70+($cptue*2)+1)."2" ,'NJ');        $TabSheet["Absences"]->setCellValue("D2" ,"Seuil");        $Position[]=chr(70+($cptue*2)+1);    }    for ($cpt=1;$cpt<count($etudiant);$cpt++) {        $Condition_du_ou="";        for ($cpt2 = 0; $cpt2 < 4; $cpt2++) {            $TabSheet["Absences"]->setCellValue(chr(65 + $cpt2) . ($cpt + 2), $etudiant[$cpt][$cpt2]);        }        foreach ($Position as $lettre){            if ( $lettre==$Position[count($Position)-1]){                $Condition_du_ou=$Condition_du_ou.$lettre.($cpt + 2).">E2";            }            else {                $Condition_du_ou = $Condition_du_ou . $lettre . ($cpt + 2) . ">E2,";            }        }        $TabSheet["Absences"]->setCellValue(chr(65 + 4) . ($cpt + 2),'=IF(OR('.$Condition_du_ou.'),"ABI"," " )');    }    for ($cptautre=0;$cptautre<count($autre);$cptautre++){        for ($cpt2=0;$cpt2<count($autre[$cptautre]);$cpt2++) {            $TabSheet["Absences"]->setCellValue(chr(65 + $cpt2) . ($cptautre + count($etudiant) + 5),$autre[$cptautre][$cpt2]);        }    }    $nbSheet++;    ///Note detailler    $TabMoyenneUE=array();    $TabMoyenneSemestre=array();    $TabSheet["Note_detail_".$matieres[0][5]]= $objPHPExcel->createSheet($nbSheet);    $TabSheet["Note_detail_".$matieres[0][5]]->setTitle("Note_detail_".$matieres[0][5]);    for ($cpt=0;$cpt<4;$cpt++){        $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(65+$cpt)."1" , $intilueretu[0][$cpt]);        $TabSheet["Note_detail_".$matieres[0][5]]->getStyle(chr(65+$cpt)."1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $TabSheet["Note_detail_".$matieres[0][5]]->getColumnDimension(chr(65+$cpt))->setAutoSize(true);    }    $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue("E1" , "M ".$matieres[0][5]);    $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue("F1" , "Rang Eleve");    for ($cptue=0;$cptue<count($UE);$cptue++){        $tmp=explode(" ",$UE[$cptue][1]);        $intituler="";        foreach ($tmp as $mot){            $intituler=$intituler.$mot[0];        }        $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(71+$cptue)."1" , $intituler." ".$UE[$cptue][0]);        $TabSheet["Note_detail_".$matieres[0][5]]->getColumnDimension(chr(71+$cptue))->setAutoSize(true);        $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(71+$cptue)."2" , $UE[$cptue][2]);        $TabMoyenneUE[$UE[$cptue][0]]=array();        $TabMoyenneSemestre[]=chr(71+$cptue);    }    for ($cptMatiere=0;$cptMatiere<count($matieres);$cptMatiere++){        $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(65+6+count($UE)+$cptMatiere)."1" , $matieres[$cptMatiere][0]." ".$matieres[$cptMatiere][2]);// intituler        $TabSheet["Note_detail_".$matieres[0][5]]->getColumnDimension(chr(65+6+$cptMatiere+count($UE)))->setAutoSize(true);        $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(65+6+count($UE)+$cptMatiere)."2" , $matieres[$cptMatiere][3]);// mettre coeff        $TabMoyenneUE[$matieres[$cptMatiere][4]][]=chr(65+6+count($UE)+$cptMatiere);    }    $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(65+6+count($UE)+count($matieres))."1" ,"Bonus_Sport");// intituler    for ($cpt=1;$cpt<count($etudiant);$cpt++) {        for ($cpt2 = 0; $cpt2 < 4; $cpt2++) {            $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(65 + 5) . ($cpt + 2), "=RANK(".chr(65 + 4).($cpt + 2).",".chr(65 + 4)."3:".chr(65 + 4).(count($etudiant)+1)." )");            $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(65 + $cpt2) . ($cpt + 2), $etudiant[$cpt][$cpt2]);        }        $cpt3=0;        foreach ($TabMoyenneUE as $item){            $CoordonneCelulle ="";            foreach ($item as $lettre){                if ($lettre==$item[count($item)-1])                    $CoordonneCelulle=$CoordonneCelulle.$lettre.($cpt + 2).'*$'.$lettre.'$2';                else                    $CoordonneCelulle=$CoordonneCelulle.$lettre.($cpt + 2).'*$'.$lettre.'$2+';            }            $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(71+$cpt3).($cpt+2) ,"=(".$CoordonneCelulle.')/$'.chr(71+$cpt3).'$2');            $cpt3++;        }        $CoordonneCelulle1="";        $Condition_du_et="";        foreach ($TabMoyenneSemestre as $lettre){            if($lettre == $TabMoyenneSemestre[count($TabMoyenneSemestre)-1]){                $CoordonneCelulle1=$CoordonneCelulle1.$lettre.($cpt + 2).'*$'.$lettre.'$2';                $Condition_du_et=$Condition_du_et."'Note_detail_".$matieres[0][5]."'!".$lettre.($cpt+2).">8";            }else {                $CoordonneCelulle1 = $CoordonneCelulle1 . $lettre . ($cpt + 2) . '*$' . $lettre . '$2+';                $Condition_du_et = $Condition_du_et . "'Note_detail_" . $matieres[0][5] . "'!" . $lettre . ($cpt + 2) . ">8,";            }        }        $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue("E2" ,"=SUM($TabMoyenneSemestre[0]2:".$TabMoyenneSemestre[count($TabMoyenneSemestre)-1]."2)");        $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue("E".($cpt+2) ,"=(".$CoordonneCelulle1.')/$E$2*(1+'.chr(65+6+count($UE)+count($matieres)).($cpt+2)."/200)");        $TabSheet["Décision"]->setCellValue("E".($cpt+2),'=IF(AND('."Note_detail_".$matieres[0][5].'!E'.($cpt+2).'>10,'.$Condition_du_et.'),"Validé","Non Validé")');        for($cpt3=0;$cpt3<count($UE);$cpt3++){            $TabSheet["Décision"]->setCellValue(chr(70+$cpt3).($cpt+2) ,'=IF(E'.($cpt+2).'="Validé","",'."IF('Note_detail_". $matieres[0][5]."'!".$TabMoyenneSemestre[$cpt3].($cpt+2).'>10,"validé","non validé"))');        }    }    for ($cptautre=0;$cptautre<count($autre);$cptautre++){        for ($cpt2=0;$cpt2<count($autre[$cptautre]);$cpt2++) {            $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(65 + $cpt2) . ($cptautre + count($etudiant) + 5),$autre[$cptautre][$cpt2]);        }    }    $nbSheet++;    /// page des matiere et fichier xls par matiere    for ($cptMatiere=0;$cptMatiere<count($matieres);$cptMatiere++){        $excelMatiere=new PHPExcel();        $TabSheet[$matieres[$cptMatiere][2]]=$objPHPExcel->createSheet($nbSheet+$cptMatiere);        $TabSheet[$matieres[$cptMatiere][2]]->setTitle($matieres[$cptMatiere][2]);        $sheetMatiere=$excelMatiere->getActiveSheet();        $sheetMatiere->setTitle($matieres[$cptMatiere][2]);        for ($cpt=0;$cpt<4;$cpt++){            $TabSheet[$matieres[$cptMatiere][2]]->setCellValue(chr(65+$cpt)."1" , $intilueretu[0][$cpt]);            $TabSheet[$matieres[$cptMatiere][2]]->getColumnDimension(chr(65+$cpt))->setAutoSize(true);            $sheetMatiere->getColumnDimension(chr(65+$cpt))->setAutoSize(true);            $TabSheet[$matieres[$cptMatiere][2]]->getStyle(chr(65+$cpt)."1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);            $sheetMatiere->setCellValue(chr(65+$cpt)."1" , $intilueretu[0][$cpt]);            $sheetMatiere->getStyle(chr(65+$cpt)."1")->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        }        $TabSheet[$matieres[$cptMatiere][2]]->setCellValue("E1" ,"Moyenne");        $TabSheet[$matieres[$cptMatiere][2]]->setCellValue("F1" ,"Rang");        $sheetMatiere->setCellValue("E1" ,"Moyenne");        $sheetMatiere->setCellValue("F1" ,"Rang Eleve");        for ($cpt=1;$cpt<count($etudiant);$cpt++){            for ($cpt2=0;$cpt2<4;$cpt2++) {                $TabSheet[$matieres[$cptMatiere][2]]->setCellValue(chr(65 + $cpt2) . ($cpt + 2),$etudiant[$cpt][$cpt2]);                $TabSheet[$matieres[$cptMatiere][2]]->setCellValue(chr(65 + 5) . ($cpt + 2), "=RANK(".chr(65 + 4).($cpt + 2).",".chr(65 + 4)."3:".chr(65 + 4).(count($etudiant)+1)." )");                $sheetMatiere->setCellValue(chr(65 + $cpt2) . ($cpt + 2),$etudiant[$cpt][$cpt2]);                $sheetMatiere->setCellValue(chr(65 + 5) . ($cpt + 2), "=RANK(".chr(65 + 4).($cpt + 2).",".chr(65 + 4)."3:".chr(65 + 4).(count($etudiant)+1)." )");                $TabSheet["Note_detail_".$matieres[0][5]]->setCellValue(chr(65+6+count($UE)+$cptMatiere).($cpt + 2),'='."'".$matieres[$cptMatiere][2]."'".'!E'.($cpt + 2));// pour reference une autre feuille  nomfeuille!celulle            }            $TabSheet[$matieres[$cptMatiere][2]]->setCellValue("E".($cpt+2),rand(50,200)/10);        }        for ($cptautre=0;$cptautre<count($autre);$cptautre++){            for ($cpt2=0;$cpt2<count($autre[$cptautre]);$cpt2++) {                $TabSheet[$matieres[$cptMatiere][2]]->setCellValue(chr(65 + $cpt2) . ($cptautre + count($etudiant) + 4),$autre[$cptautre][$cpt2]);                $sheetMatiere->setCellValue(chr(65 + $cpt2) . ($cptautre + count($etudiant)+4),$autre[$cptautre][$cpt2]);            }        }        $TabSheet[$matieres[$cptMatiere][2]]->setCellValue("A". ( count($etudiant)+4+count($autre)),"Resposable");        $TabSheet[$matieres[$cptMatiere][2]]->setCellValue("B". ( count($etudiant)+4+count($autre)),$matieres[$cptMatiere][6]);        $sheetMatiere->setCellValue("A". ( count($etudiant)+4+count($autre)),"Responsable");        $sheetMatiere->setCellValue("B". ( count($etudiant)+4+count($autre)),$matieres[$cptMatiere][6]);        $objWriterMatiere = PHPExcel_IOFactory::createWriter($excelMatiere, 'Excel2007');        if($option=="") {            $objWriterMatiere->save('./' . $repertoire . "/excel/" . $matieres[$cptMatiere][2] . "_" . $DEPARTEMENT . "_" . $autre[4][1] . "_" . $annee . '.xls');        }else{            $objWriterMatiere->save('./' . $repertoire . "/excel/" . $matieres[$cptMatiere][2] . "_" . $DEPARTEMENT . "_" . $autre[4][1] ."_".$option. "_" . $annee . '.xls');        }    }    /// mettre en feuille de chaque matiere vers detail_notes_du_semestre    $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');    if ($option==""){        $objWriter->save('./' . $repertoire . "/excel/Bilan_" . $autre[0][1] . "_" . $autre[4][1] . "_" . $annee . '.xls');    }else {        $objWriter->save('./' . $repertoire . "/excel/Bilan_" . $autre[0][1] . "_" . $autre[4][1] ."_".$option. "_" . $annee . '.xls');    }}function validateDate($date, $format = 'Y-m-d H:i:s')// permet de verifier que c'est bien un date;{    $d = DateTime::createFromFormat($format, $date);    return $d && $d->format($format) == $date;}function validationFichier($fichierMatiere,$fichierEtudiants){// permet de savoir si le fichier exste ou pas    if(file_exists($fichierMatiere)==false){        error_log("Erreur le fichier ' ".$fichierMatiere."' n'exite pas dans le repertoire Liste_annee ou le nom  du fichier ne correspond pas exemple : Liste_Matières_S1_1617.csv ");        exit(1);    }if(file_exists($fichierEtudiants)==false){        error_log("Erreur le fichier  ".$fichierEtudiants."  n'exite pas dans le repertoire Liste_annee ou le nom  du fichier ne correspond pas exemple : Liste_Etudiants_S1_1617.csv ");        exit(1);    }    return true;}function chercherFichier($semestre,$option=null,$option2=null){    global $DEPARTEMENT;    if ($option===null && $option2===null){        $fichier_Matiere="Liste_annee/Liste_Matières_".$semestre."_".(date("y")-1).date('y').".csv";        $fichier_Etudiants="Liste_annee/Liste_Etudiants_".$semestre."_".(date("y")-1).date('y').".csv";        if (validationFichier($fichier_Matiere,$fichier_Etudiants)===true) {            convertCSVtoXLS($fichier_Matiere, $fichier_Etudiants, date("Y"));            $dossierDest="./$DEPARTEMENT/".(date("Y")-1).'-'.date('Y')."/$DEPARTEMENT"."_"."$semestre"."_".(date("Y")-1).date('Y');            if (!copy($fichier_Etudiants,$dossierDest."/Liste_Etudiants_".$semestre."_".(date("y")-1).date('y').".csv")){                error_log("Erreur sur la copie du fichier");            }            if (!copy($fichier_Matiere,$dossierDest."/Liste_Matières_".$semestre."_".(date("y")-1).date('y').".csv")){                error_log("Erreur sur la copie du fichier");            }        }    }    elseif ($option!==null && $option2===null){        if (validateDate($option,'Y')===false){            $fichier_Matiere="Liste_annee/Liste_Matières_".$semestre."_".$option."_".(date("y")-1).date('y').".csv";            $fichier_Etudiants="Liste_annee/Liste_Etudiants_".$semestre."_".$option."_".(date("y")-1).date('y').".csv";            if (validationFichier($fichier_Matiere,$fichier_Etudiants)===true) {                convertCSVtoXLS($fichier_Matiere, $fichier_Etudiants, date("Y"), $option);             $dossierDest="./$DEPARTEMENT/".(date("Y")-1).'-'.date('Y')."/$DEPARTEMENT"."_"."$semestre"."_".$option."_".(date("Y")-1).date('Y');                if (!copy($fichier_Etudiants,$dossierDest."/Liste_Etudiants_".$semestre."_".$option."_".(date("y")-1).date('y').".csv")){                    error_log("Erreur sur la copie du fichier");                }                if (!copy($fichier_Matiere,$dossierDest."/Liste_Matières_".$semestre."_".$option."_".(date("y")-1).date('y').".csv")){                    error_log("Erreur sur la copie du fichier");                }            }        }        else{            $d = DateTime::createFromFormat('Y', $option);            $date=$d->format("y");            $fichier_Matiere="Liste_annee/Liste_Matières_".$semestre."_".($date-1).$date.".csv";            $fichier_Etudiants="Liste_annee/Liste_Etudiants_".$semestre."_".($date-1).$date.".csv";            if (validationFichier($fichier_Matiere,$fichier_Etudiants)===true) {                convertCSVtoXLS($fichier_Matiere, $fichier_Etudiants, $d->format("Y"));               $dossierDest="./$DEPARTEMENT/".(date("Y")-1).'-'.date('Y')."/$DEPARTEMENT"."_"."$semestre"."_".(date("Y")-1).date('Y');                if (!copy($fichier_Etudiants,$dossierDest."/Liste_Etudiants_".$semestre."_".($date-1).$date.".csv")){                    error_log("Erreur sur la copie du fichier");                }                if (!copy($fichier_Matiere,$dossierDest."/Liste_Matières_".$semestre."_".($date-1).$date.".csv")){                    error_log("Erreur sur la copie du fichier");                }            }        }    }    elseif ($option!==null && $option2!==null){        if (validateDate($option,'Y')==false && validateDate($option2,'Y')==true){            $d = DateTime::createFromFormat('Y', $option2);            $date=$d->format("y");            $fichier_Matiere="Liste_annee/Liste_Matières_".$semestre."_".$option."_".($date-1).$date.".csv";            $fichier_Etudiants="Liste_annee/Liste_Etudiants_".$semestre."_".$option."_".($date-1).$date.".csv";            if (validationFichier($fichier_Matiere,$fichier_Etudiants)===true) {                convertCSVtoXLS($fichier_Matiere, $fichier_Etudiants, $d->format("Y"), $option);                $dossierDest="./$DEPARTEMENT/".(date("Y")-1).'-'.date('Y')."/$DEPARTEMENT"."_"."$semestre"."_".$option."_".(date("Y")-1).date('Y');                if (!copy($fichier_Etudiants,$dossierDest."/Liste_Etudiants_".$semestre."_".$option."_".($date-1).$date.".csv")){                    error_log("Erreur sur la copie du fichier");                }                if (!copy($fichier_Matiere,$dossierDest."/Liste_Matières_".$semestre."_".$option."_".($date-1).$date.".csv")){                    error_log("Erreur sur la copie du fichier");                }            }        }else{            error_log("erreur sur les arguments Semestre groupe et Année ");        }    }}//var_dump($argv);if( count($argv)<2){    error_log("manque l'argument du semestre");    exit(1);}$semestre=$argv[1];//Semestre$option=null;$date=null;if( count($argv)>=3){    $option=$argv[2];// groupe si il y a des lite spécifique date passer en paramettre si elle n'existe c'est la date courante}if( count($argv)>=4){    $date=$argv[3];// groupe si il y a des lite spécifique date passer en paramettre si elle n'existe c'est la date courante}//convertCSVtoXLS($inputFileName1,$inputFileName);chercherFichier($semestre,$option,$date);